[%- SET IFRAMEHEIGHT = 128 -%]
[%- IF parsedmessages -%]
	[%- SET IFRAMEHEIGHT = ( IFRAMEHEIGHT + ( parsedmessages + 600 ) ) %]
[%- END -%]
[% IF onlineparse == 1 %]
	<body style = 'margin: 0; padding: 0; width: 600px;' 
		onLoad = "parent.document.getElementById('parseddata').style.height = '[% IFRAMEHEIGHT %]';
				parent.document.getElementById('doparse').value = '解析';"
		onAbort = "parent.document.getElementById('doparse').disabled = false;">
		
		[% prototype.define_javascript_functions %]
		<script type = 'text/javascript'>
			[% INCLUDE bouncehammer.js %]
		</script>
		<style type = 'text/css'>
		<!--
		html { overflow-x: hidden; overflow-y: auto; margin: 0; padding: 0; }
		[% INCLUDE bouncehammer.css %]
		[% INCLUDE record.css %]
		[% INCLUDE testparse.css %]
		-->
		</style>

		<h2>解析結果</h2>
		<div class = 'result' style = 'margin:0; padding: 0;'>
			<div class = 'upload-summary'>
				<table>
					<tbody>
						<tr>
							<td class = 'key'>元データ</td>
							<td class = 'value'>[% parsedfilename %] </td>
							<td class = 'extra'> </td>
						</tr>

						<tr>
							<td class = 'key'>データ容量</td>
							<td class = 'value'>
								[% IF parseerror == "toobig" %]
									<span class = 'errortext'>許容サイズ超過</span>
								[% ELSIF parseerror == "nottext" %]
									? バイト
								[% ELSE %]
									約 [% parsedfilesize %] バイト
								[% END %]
							</td>
							<td class = 'extra'> </td>
						</tr>

						<tr>
							<td class = 'key'>メッセージ数</td>
							<td class = 'value'>[% parsedmessages %] 件</td>
							<td class = 'extra'> </td>
						</tr>

						[% IF onlineupdate == 1 %]
							<tr>
								<td class = 'key'>新規登録数</td>
								<td class = 'value'>[% updateresult.insert %]</td>
								<td class = 'extra'></td>
							</tr>

							<tr>
								<td class = 'key'>既存更新数</td>
								<td class = 'value'>[% updateresult.update %]</td>
								<td class = 'extra'></td>
							</tr>

							<tr>
								<td class = 'key'>非登録/非更新数</td>
								<td class = 'value'>
									[% updateresult.skip %]
									[% IF updateresult.skip > 0 %]
										(
										発信者ドメインなし: [% updateresult.asitis.nosender %],
										古いデータ: [% updateresult.asitis.older %],
										ホワイトリスト: [% updateresult.asitis.whitelist %],
										登録上限数超過: [% updateresult.asitis.exceedlimit %]
										)
									[% END %]
								</td>
								<td class = 'extra'></td>
							</tr>
						[% END %]
					</tbody>
				</table>
			</div>

			[%- IF parsedmessages -%]
				[% IF outputformat == "html" %]
					[% INCLUDE "div-result.${mylanguage}.html" %]
				[% ELSE %]
					<textarea name = 'serialized' id = 'serialized' class = 'serialized'
						rows = '12' cols = '90' readonly = 'readonly'>[% parseddatatext %]</textarea>
				[% END %]
			[%- ELSE -%]
				[%- IF parseerror == "toobig" -%]
					データサイズが大きすぎます。
				[%- ELSIF parseerror == "nottext" %]
					電子メール形式(テキスト)のファイルではないようです。
				[%- ELSE -%]
					解析対象となる内容は電子メール内に見つかりませんでした。
				[%- END -%]
			[%- END -%]
		</div>
	</body>
[% END %]
